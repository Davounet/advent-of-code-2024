const input = `##################################################
##.O...........#..O...O.O....OO......OO...O.O..#.#
#OOO...OO.#O...#..OO.O.....O..##O...O....O....O..#
##....O...O.........OO#...O.O#.#O.O.....#........#
#OO.OO.O.OO.#.O..O.O#.O...OO..O..O#.OOO...O....O.#
#O...O.O..O....O...OO..#...O.#O...OO......O..#.O.#
#..O.......OO..##.#.O.O.O.....#...OO..O....O..O.O#
#.O....OO.O#.#O.O........O.#......O..##O..O....O.#
#O.....O..O.O.O...#......O.O.O...O#.....O#.#..O.##
#.......O..#....#....O....O..##O.......#.....O...#
#.....#...OO.O...O....O..O#.........O..O.O.O.....#
#O.......O.......O..O.O....#.O..........O...#...O#
#.OOOOOO#...O#...#....O...#.##...#..O.OO#OOOO#...#
#..O....O.OOOO.O.#......O.##...#.#O...O....O.O.OO#
##OOOO###..O..O.O.........#...O#.O..O.OO..##..OO.#
#......OOO.....O....O...O.#..O...OO...OO.O...#O..#
#......OO...#O#...OOO.........O........O.....OO..#
#.#...O.O....#.......OOO...O...O#.OO..#.#.O..O...#
#OO.O...O.O.#....OO..#.O.O.......##O..O.O..O.....#
##.O#OOO.....O.....#.....O#..OO...O..O..O.....O..#
#...O.O..O..O.O.....O.OO.....O...O...#..O.....O.O#
#O..OO.O.#..O..O....OOO.O.O.............OO....O.O#
#.OO#O.O.O.OOOO#O...O.#.O....#........O.O..#...#O#
#O.O.#O..#...OOOO..........O...#OOO....#O..#O..O.#
#..O.OO......#...OO..O.O@O#.#.....O.....#.#OO.#..#
#O..O.....OOO....O...#..#....O..#OOOO........O...#
#O..O#.#..O.....O.O.....OOO..O..O.#..#OO.....O.O##
#..........O....O...O.#......O..O.......O........#
#.OO#......O..OO...#O.O.#.O..O.O..........OO....##
#..O#O.O....O#...O.O.O.O.O..O.O.##O.#..O.O.O.#O..#
#..OOO.O.O...#.O.O.......O...#OO..OO.###..#O#..O##
#.#OOO.....#..O....OO.O..#O.OO..#O#.O.#.OO.......#
#.........OOO.OO.....#.....#O.O.OOO...#O...OO.#O##
#...O...O......O...O#..O#O#..O.OO.O..O.O...O.O.O.#
#.O.....OO...OOO.OO..O......OOO...O#.....O....O..#
#O..O.......O........O...O.OOO.O..#..O...O.OO..O.#
#...O..#O.O......#..O.......OO.#..#O..#O.O..#.OO.#
#..OO....#.....OO.O#....O.O#.O...O...O..#..#.OO.O#
#...OO.O........O...O.O......O.O.............#OO.#
#.....#OO......O#..O#O....OO#O....O#...OO.#OOO...#
#.....O.OO......OO#...#O......OO#...........O.#O##
#.OO.O.O.OO....O........#..........O..........O..#
#O.OO..O.O..OO...O...O.OO..O.....#..#.OO.OO.OO.OO#
#..O..O..O.O.#.....O#..O...#.....#...O..O....O..##
#O...#....O.#....O....OO.OO..O..O....#O..O.O.O.O##
#..O.......O........OO#.....O.........#..........#
#...O.#.O.OO#.......O.#...O.O......O.O...........#
#.#.....O......O#.#.O...O#O.O.O...O.....O..O.OO.##
#.....O.O..O.......O......O..O...O#O#.....OOO....#
##################################################

^^^v^^v><vvv>^v^><<^>>^^^<^vv^v>v^><v^v>v>v^<^^v^>v<^><^>^<>>><<<v^><>v^>^^^<<<>^<^<^v<^<><v<vv^^>^>v><^v><v><vv>^v<>v^v^^>>vv<^^^><^>>^^>v^^^v^>^v>>^<<v>v>>v<vv^^v<v>^<vv<><><^><<v<^<>^^<>>^>v^^<<^>v<>^<v<>vvv^v<>>vvv^^v^<v<v^^v^<>^^v><>v><^^<vv<>v<<><v><^^v><v<<>>>><^>^^>vv<><vv^>>>v^>>^^>><>^>>><vv<<v^^^^<<>v>>><>v<vv><v<>v>>v>^vvv><v^>v<^v^^<^^>^<^v<vv>>>^>>^<>^vv^v<^v<v><^>^<<v>>v>^^vv><v>^>vv<><^>><^^>><<^v><>>^><^<^^v><v<<^vvv^^><^^^^v^^v<>v<>>^>^<v>^^<^v>>>^v>>>><<<v<>><<<vvvv>><><><>vvv<>^^<vv^^<>^<vv>v<^^><>>^>^<v><>^v><>v>v<v<<<v<^vv<v>v^v<<^v<>^v<<<v>>vv^<vv<v^^<><^^^<<v^><v><><vvvv>^vv><^><v>^^v^^<v>^vv><<v^>v<<>^>^v>v<v>^^>v<<v>^^v^>^^^v^vv<<v^^^<<<<v>>^vvvv<^<^vv<<<<v>>v^v^<<^^<vvv>^<<v<v<^vvv<>^<>>>>v<^>v>>v>^>v<><vv>^><vvv>^^<^^^^^vv>^>v<<^^vv^>><<>v<vv>v>v^^v<>^^>vv<>vv<>><<^<<>>><v^^^>vv><^^<^<<>>vv<><><^><^>v>>^>v<^^<>vv<<v>>^<<^vv^<vvv<^^>v<^>>^^v><<<><><>><<>^>^>v^>^^<^vv><<vv>>>v<<^<^^v<v^><>^>v><^v<<^v^v<<v<v>>^^>^>v><v^vv<>>^v<<^v^v><<v><v><<^v><v>><>v^<^v^<>^v
^^<vv><^^<>>^><<>><>v^<v>>^v<>>^>>^<>^^v>^<><^v>>^><>>v<v>^^^^vvv>^v<v^<v^v>v<v>^vv><v^<v<^<<><<<^vv^v<^v<>v^vv^^><>>v>vv>v>>^^>v<<>^>^^^^vvv>vv>^<>><<v<^>v<>v<<>^<v>><^><>^^^v<^v<^>>v>^v^><>^<>>v>>vv^>v>>>>v<<^<^v<^v><>^<v^>^>>><>^v<<<<^^<v<<v^v^vv^^<v^v>>v^v>v<^v<>v>^^^^v>^^<^^>v^^>>v^<><><>v<^vvv^<<<>^^^^^v>>v^v><vv<vvvv>>^><v^v<^^^><^v>^v<vv<<<v^^<>v>^<>v^>>>>v<v>>v<<vv>><>>v<^<>><<v>vvv>>^>>v><<<^^^>vv<><v<^>vvvv^v<vv^^<<>^vv><><>v^<><<v^^>>^>>v><>>>v>v><v^^v>v>vv^>^><vvv>vv<<<^^v<v<v^v^vv^>v^>>>>^<^<^<^>>vv>^>>v><<^>v>^>v<>><><v<>^<^>>v>v<<>^>^<>>vvv>>>^^><^^>^<v><^^>^<v<<<>>^^<>^<><><^<>^<>>^<><>^^<<vvv<<><<>>v<>v^^^^^vvv><<^^><>v^vv>vv>>^v<<>vv^>^<v>vv^>^v<><<^>^>>>v>^>>vv<^^^v>^^^^v<<<<<<^<^v>^vv><^>><^>>^^<v<>^^^<<v><><<^^^>v^^^v^>>>><<<><<<vv<>^^<><>>^^<v^vv><>v>>v>>>>vv<^>>v^^^<v<^><^vv>>>vv<<>>v^^v^^v>v><<^v^><vvvv>v^>>v><^^<<>v>v<^^^>vvvvv^>>>>vv^^v><v<^v>>v>^<<^v<<>>v<>^>vv>vv<<v>v<v<^^<^<<<^<^v<><><>><>v^<><^<<^v<v>v>^<<<<<v>v^>v<>^<>^v>vv>^^vv^^<<^<>^<<>v<v<^><<^<^vv^<
>^^>v^>>vv^^v<<<vv>v<^>><v>^v>^^><^v^^^><v<>vv<>>^><^v><vv^v><<<vv>^><^<vv<<<^v>v<v<^<^^v^<>>>v>v<v>><<vv^^v<v^^>^v^>^v<^><<<>vv<>v<><<v><<^>>v^<^>^v<><^<^<<>v<vv^v^<vvv^>v^^^v<>^<<>>vvv<<<<^<<vv^<<<v><v><<vv^<>^vv>v>><^vv^<v<v^^vvv><>>^v^^^v>v<<<>v^^>>v^<<v>>>^<><>>^^^^^vvvvv>^vv<><><>vvv<^v>>vv<^vvv><^^^>>^>>^<>^>^^>>^^<>^^vvvv><<^><^><>v^><^^v^^<^v>vvv<v^>^>>><<<<v^>v^<^<>^v<<>v<><>v^^^v>^v^^^>v><v^>^^^v<><>^^>v<^^^^v>>v><^v>>^vv>^v<<<<v^>^^<<^<<<v<^<^^<v>>v>>vv<<><^v^^<><><^<<vv<v<^^<v>><^^^<v<v<^>^v^<<^<v<>>>><<v<^^vv>>^^<><vv^v<<<<<<vv><^>>v^<v<v>^>^vv^v^<>v>v<<>v<>v<vv^>^>>^>>^<^^<<^v^v^^^vv>v>^v><^>vv^<<^v>>^^v>^^v>^>>^>v^^>vv>^<v><<>v><vv>^<<>><<<<vv<<>>^^<^^v<vv^^^<>>^><>^>><>>^<><>^<^^<^>>v<^>><<<<<^<v>v>^<v>^>^vvvv^>>^^v^^^^^vvv<^^<<<^<^v<<^<<<<^>>^^>vv^>^^<vvv^^^v<<<><<>v><v<^^>><<>vv>^>v<^^^^<v<<v^v<<<><vv^v><^><>>><^vv<<^vv^>>><v^><v^>v^><vv<v>><^v^>vvvv><^<>><>><v<<v>v>><<<^^>>^^<^^>vv<vvvv><>v^v^v^<>>v^<<><><<<>^<v^^>v>v<><>v>>>^>>^<^^v>><><v^>v>^>^v^^^^>>v^^^v^^^v>>v>
^>v>>^>>>^>^<>^v^^<^<><v^>^vv^<<>v>vvv>>v><>^>v><v<<>^>>>^<>><>>><<^<>^^<>><^<^<^<v<v><<^<v^>><<v^^>^><^>^<^>vv^><v>v>^vv>v<^>vv><^>v><vv>v><v<>^^>vvv<>^^^^><v^<vv<^v^v<>>v>>v>><>>v^<v>vvv<v<^^^>>^^vv>^><<<<v<<v<>^^^vvv>><^^v^v<v^<>^>><^v^^><v^^^>>v<v^^<>>>><<^^>v^vv>^^v>^<<vv<^<vvvv><vv^>^v^v<<^<v<^>vv>vv^<>^<<>^^^^v<^v><v^>v^<^^<<v>^<<^^^^vvv<>^^<>^><<^>>^^<^^^v>><^>>^v>^^<v^><v^^<>><>>^v>>^v>^>><^><>^^v>>^<<<v^v^vvv>>v>^v<^>>>^><^><>v>^v<<<>^>^v>v<^vv<v^<><><><^^^v<v<^><^<^<<<>^<v^v^v^>v><><v<>>>^vv>^<<^^^v<>^^v>><>^v>^^>^<><><<<>>>^<<<v>v>v^<><<><v>>>><vvvvv<>v^^<>v<>v^<<><<><><<>^vv^>v<<<^vvvv<<>><<<>v>>^v<^v<^<^>vv^<^^^<<<^v<v^<>v>>^vv^<<vv^<>v>^v<>^v^v^<<^>^^^^v<<^v>>>^^>^><<^<^>>>vvv<>><>v<>^<vv^^<^^>^<>^<v^<<><^<^<^^><><v^>v<><>^v<<>>v<^>v<v^v>^>v^<^>>>vv^^v<><>^^<><v^^<^vv<^vv^^<^>v^<<^><vvvvv<<<^>v<v^v>>^<<<<v>>v><<v^<v^<^^v<<><^v>>>>v<>v<^<vvvv>v><^v^v^<vv^^>v<v^>>v<>vv^<>^>v>v<><><>v<^vv>v^^^vvv<>><<v<<>^<>>>vvvv<>v<^^<^vv<^v^>^v^v^><>><vv^>>^<<v>>><>>>v^^<^<^<^<^<^><><^<>
^><v>^>v>^<<vv^><^><^^<^>^<><v<>><<v<>>>^^<<<<v><v<vv<v><<<vvv^^<v>^^^>>vvv^^^<<>>^^<^^><vvvv^<>vv<v>>^>^^>v<vv>v^^>^<^<^<vv>>v<<>>v^>v<>^^>v^>^v^>v>>>^><^>^>v<<^<v^><>vv<v<v^<v^vv^<>^^^<v>^<vv><^^^^<v<>^<>^<<^>^>v<>^<^v^<><><>^<^<^^v>>^^><>v<^v<^>>>v>><><><v><<^>v<<^^<v>><^^<>v^>v^^>>>v>^<<v<><<^vvvv<>^^>v^v>^<>^>^v<<><>^<>^>>v^v><v<^>^v>^>vv<<<v>>v>^>^<v^^v^^<vvv<^<<<v^>>vv<<vv^<<<v<^^^>v<^<<^<><><^vv>>>v<<^<^<><<^v^^^v>v><^v<<>>>v^^vv^><<^><v^<v>>v^<v<>>v><vv<<^<<^v>v^<>>v^<^<^<^^vvv<^^v>v><^v<>^v>v>^<<<^vv^^vv^>vv^^>v><v<<<><<<vv><>v^<^<>>v^<<vv^^^^^>v^<v<v<><>>v^>v^>^v><^<^v<^<<^v^v^v<>^<>vv>^>v<^^^^v<<^<><<^^<>>v>^>^>>><v>^<^v>>^<^<><^^>v>>^>><><>>>v<^^v>v^>v<v><^v>>^<<><>^<><v<v<<vv<v<<^v<>><^^v<>^>v<<^>><^v^<<^>vv><>>^><<><>>^<<^<vv>v>^^>v>^><^<><vv>v^v^^v<<<<>vvv^<^<v^v<^^>v><^>^>^v>v<<<v^^v<^vv>vv^v>v^v><^^v<><v<<^<>><<>>>^>>^v^>>^<v<<><vv^><<<<v^^^<^^<^vv^v>>>>^^v^>>v<<^v^v>v^^v<>^^>v>><^<v<^v>^<<>^><v><v>vvv>v^v^^v>>^v<><<><v<^>v^<v<>^><<^<vv<<><vv>^><>^vv^v<v<^>>>>^v>><<><
<v^^<><<>v><>>^^v<^^vvvvv<>v><v>^><>v>^v^v^v^>><><v>v^>v<^^<v^><^<>^<<>vv>v<<v^>v<<^<v<>^><>^^v<<vvv<v>v^<^>^<v>v<vv>>>v>>v<v^^>v^>v<^><^<v^>^^v>v>v<><vv<>^vv><<^v><<v^v>>v^v>^><^<^>v^^>^>^^v^^<>>vvv^^>^>><vv>v^<^v<<<v<><>^><<><vv<^^^^^v<>^v><^<<>v>^<>v>>^v<<^>^^^<><>^>><>>>v<v<<<v<v^v>v<^>>^><v^vv<v<>>>v><vvv<>>v<<<>v<>^v<<vv<><>><^v^vvv^>^<><><^v><^v<^^vvv>vv^<<^^<v^><^>v^^<^v<v>><<v>v>v<<vv<<>><<>v<^<<<>vv<v^<^<<^v<>v^^>^>v^^^^<v^^v^>><v^v^^^v^>v><^<<^>v^v<>^>>><>^^<>^^<^<v<>v^<^vv>^<>><>^<^^<<v<^>>v<vv<<v<v<>^>v><^v<v^vv<v>>^>^^<v>vv^^^<<^>><^<^>v><>>>v><^<vv<vvv^<><><>v<><<<v><^>^>^>><<<^^><>vv<^v<<vv><^^>^<v^^><v^<<v<<><><v^v>v^vvv^><>vv^<^<^<<<v^vv^><v<<>^<v>>v^v<^<>>^^^>>v>^v<<<^<v^<>><v^^v>>^v><<<<<v>^<>^v^>vv>v>v<v><^v><^vvv>v<^^^^><>>>><^^><<^^^<>>><<<<<<<<^>^>^^^^<>^<<vv<>><^^>>^v^^^>v><v>v<v<^<^<v>>^<^<>>^<^<<<v<<v^<>>>v>><>>^^vv<<^v>^vv^v^>><v>v<<v><^v<<<<^^<^^<<>>^^v<<<>>v<v^^vv^^><^vvvv^>^^v^^v^>^<>>vvv<vvvv>><^v>v^>^<vv^>v<<>>>^v<v^^<vv>v><>><>vv^vv>><^>^<>^^^><^^<<><^
><<v^v>v>>^>vv^>^><^>^^^v<<^^^^<v>^v^v^^<^v<><<<v<>v^vvv<v^v^><v>>v>v^<<^^>>^^^v>v^>>^<<^^<<<^^<>>>>^v<>><>>>><v^>>>>^^>v<^<>vv>>vv>v<v^v><>vv>^^v<<<v>>^>vv<v<v>v^v<<^<^<vv<>>><^^>><v<v<v^v>v<v>v>>vv<v<v^^^v>^>>>v^v>^^<vvv<>>v>v<v<<><><><<^<<^>v^><>^v>><>>^v^v^>v>^<^^>>v^>v<^^^>v><<<v^vvv^<v<>v<>>^^v>vv>vv^^><>^<^^v<>>^^<v<^v^<^v>v>^v^<vvv>v>vvv<^v^><<^^v^v>>>^^^<^^^^<^^^<>vv^^^^^>><><>>v<>>vvvv<>>vv<v>v<^>^v<<<^>^>>>>>><<<>>^^>>v><vv<vv^><^>v<^vv>v^>^v><<>>v<vvv^^^><v^>vv<^<^>v>vv<>^>^<vv^>^><v<^^vv>>v<>>v<v^>^><<>^v><<>>vv>^v>v>^^<>>^<vvv><^^<<>v>^vvv<>^>>vv^>><v^v^<><><>^^<^^v<<v<^<^><>>^<^<^^<v<>>>>v<>v^>v<>^v^^<^^><^v^v<^><^^>v<v^>><<<^<<<<^<v>^v<><vv>v>v<<vv>>v<^<^v^>>v>^>>vv^<v^^><^vv<>v>v^^vvv><<vvv<^<>^^vv^<><^>^v^^<v<^>v><v<<>^<^v^v>^^v>>>^v<v^^<v^v<>v^v<v<<>^>^v><><vv>>v<^>vv^>^v<v<v^^>v<v>v<>v><v^v^^<vv>>^>v>>>><>^v>^^^<v^><>v><><>^><^v^v>>vv^>>v<^<^^v>^^v<^vv>v^vv<^>v<<^<^v<<^>^^<>v^<v^^>^><>^^^v^vv^<^>><<^^<^>^^v>>>v^<^<<v<v^^><>v<v<^>v<^v>>vv>^^v<>><>>^<v>>^^v^>v<>^vvv>^
>v^<<v<>v>><^<v>^<>v>><v^>^v^><><<>^<^<^<^><vvvvvvv>v^<v^<>^>>>>><>><vv>^^vv<v^>>><v><<^<^>>^>>^^<><>^^<<<vv>><^vv>>v^^v^<<>^v>v^^v^>^v>vv><^v<v>vv<>v^v^^^v<<^>>><<<><vvv^<>>>v^v>>^>v^<<^^<^v^<>v^<>>v<<vvv>^^vv<<^vv<<v^vv^^^^v^v^^vv^>v^<^<<v>^v>v>><^>^<>>^v<v^v^^>^v<^>^^><><v<^v>^>>^<<^v^>v>^^<v><vvv^>v^>>>v^><v><>>v<^><^<v<>^<>v^v<>vv>><^<>v<><>>^>^^v^><v>^v^^vvvvvvvv<<^>v<vvvv><^<v^v<>><<<>v>v><><v^>>^>>^<<<<<>^v^<<<^^^v<<v<>>><<>^^>^>>v^^><><>vvv>>vv<><^^v^<>v<^v>v><><^^v^v<><^^^vv^>^v<<><<><v^^^<><v<<^^<<>^v>^<>>v>>v^>v<<>>>>><^><>^><v^<<<>^>v>>><^<v<^v>^v><v<^>^v>v>v^<<^><>v<<><^^^^vv^<<>^<<v^^^vv>v^^><v^^^><<<><<^vv<>v<<vvv<<v>v<vv<^^>><<^<v><>>>^^>vv<>v^<^^^><>>>v<^><<>^<><>v>>>><vvv^^>^>^^^><>><^><vv^vvv^<<<><v^^<v^^<^^^><>vvv>>v^v<vvv^<<><<v><<^<<<^^v^>v>^vvvv>^>v^<>>>^>v^>^<>>^>vv<<<^<^v^>><<^<><>v^<^<<^v<^vv>v><<v^><^^vv><^v^<<><<vv^<^^><^>>^<<^<vv<^>v<<>^><<><>>v<^>>^>>v>>^<v<>><<<^vv>>v^>^^<^v>^^^vv>><vv>^<><<^><><<>^^<v>v<vv<<>>^^<^>^<^v<^^^^>^v^<^>>v>vv><vv>^<^>vv>v>^>>^
v<v>v>v<v<v^>^^v^<<>>>^v^vv>>^^v>^><^v><^vv^^^<>>vv<<<^^vv<^vv>>^v^>^^vv^^<^>^<^>v^^<<<<<vv>^<>>v><><^><>>v<v<^><v><>v><>^<^<<v<<>^^^v<<><><v>^<^<<vv^>>>><^^<^<><^<>v^<v^^>^^^^<v>^vvv>^v<v>v<>>>>^^><v<<<vv>>>>><<<v^>>^<^>^<>>><^><^^^vv<^>v<v<^v^v<>^v>^^vvv<>^><v^<^><<><vv^^^<^v>>v^v<>^<vv<v^<<<>^>v^>v^v<>>^v^<>v^v^v>vvv^>^<><v^vvv<<vv<>^>^>v^><>^<^^vvv>>v^^v^>><^vv>^v<<v>^>v><^v^<v>v<^<v<<>>^>vv^^vvv>vv^>v<vv>>^^<^^^v^><vvvv<<^vv>^^<vv>^^<<<^<v>^<vv<v>>^>>vv<<<>v^<v<^>^>^vv<^vvv<v>^vv>>^^v>v^<v>v>>><>^^>>>^^<v<><v>^>>><v><<vv<<>v^v^v>vvv>>v>>vv<^^<^^<<>>vvv^^^><>><v<<^<v>>^>^<>^v<^^v<<^>>vvv>>><v<^>^^><>v^<^<^>^v>><<<<^vvv<>^vvv>>^<v<^^v>>v<^><<^>><<vv^^^<^^^>^<vv>v>>^>>>^^>v^>v<v>vv><v^<<<vvv^<vvv<>>v<>>v><^^>^<v><v><^><>^^vv^<v^<>v^>vv<^>^<v^^>v<<<^^><<><<<^^^<^^>v>vvv^<>^^v^v<^>^><<><^<v<<^>^^>>v^>v>^<v>>^v><>v^v^^vv^<<<vv>vv>v<v><>>^<vv^<>^vv^v^v><>^^><>><>v><v^^>>>v^^<><<<<v<^^^<^><^>>^>^vvvv^<><<<^<^<^^>>^v<vv>><vv^<>>v<>^^<^v><v>>>vv<<^<<^vv^<vv<<v<>^>^>^vv<vv^<v<<>><^v>v><>>^<v
v^>^^>>v^^^><>^<><<^><>v^v<>vv<v>^^<vvv>^^>v>><vv<>^>v><^<>>>vv<>^>^<>^<v^v<v^^^^><v<v^^<v^v^v<^>>>^><^^v>>^vv^<^<>v>v>v>^<>^>v<v<v^^<v<><<><><<^v^<^^v<<^<^v<^v<><vv<^><^^>^>>^v<<<^><>v^<<^><>>>>v>>>>^v>><>>v>><<v><^^^<^><>^^>^v<^>v^<>vv<^^^^<><v>><v<<<><vv<^^>v^><^v^^vv^<v>v^^^^v>>^vv>v<><v>>v^<vv<^v>^><v^<^^vv>^<<vvv>^>vv^v<><^vv^v^<v><v<v<>v^<^><v<<v>^<^>^>v^v>v>^v>>^><^>>vv^^vv<<^vv<^<v<v^<>><^>vv<<>v^^<^^<v<v^<><<<v>><v<><^^v^^v^v><<vv>^^<^v><v>>^^>v<v><v^<>>><^^v^<<^<>^<>v<v^<^<v>^<<^^^>>>^><vvv>>>v>vv^v^^<<^^<v>>>><><>vvv<<^vvv>>v<><>><v<>vv^^<^^vv<v<^>^^^v^^^v^v>><<>^><^v<<v>^<><<>vv^<<v<^>^vv<^<^v>>v>vv^<<v<v<<^v<v^>v<v><>^>^<v<><>>v<>v<vvv^^<v^><vv<><^>><v^<v<vv<<>><^^<><^v<><^^^vv<<>>>>v><<^<<>^^><v>^>vv<v>>>vv>^v^><>v>^>^>>v<vv^>^<<>>v<^^^vv^^^<>v<<>^>v^>vv^^>^v>v<^v>v>^>^vv^>>v>vv^^^<v^^^<^^<^v<>vvvvv^v<^^<v>^<<<v^>>><^vv>>v<v>>v^^^v^<^vv>>^>>>>^><^>>^^v^^^^>><^vv<>v^v^^><v^>^<<>>v<><^v>v>>>^<<^<<^<<vvv^v<^vv<vvv>v^^>>>>v>><^vv<<><^^v^<<>>v>^v^vvv^v^>>^v^^<>v^<><^>><v>>v>>
>><<<v>><<^<v>^<v<>>^><<^<>>><^v<<^^<>^v>v<^^<vvvv^^^v<^<^<vv><^<^<>^vv><<v^><>^><v^>>>v<>^v>^<v><>>v<^>>><>^v>^<v<<^^vv>v^^>^v<v^vv<><v>^<^<>^v>^>^^<v^<^>v^<vvv^<vv^^^^v^<>v>^<v><v>v^<<<<<<>^^^^^^<vvvvv<>>v><<>^v><vv^>^>v>vv><^v<^>v^<<^^v^>^>>v<^^>^<v>v^vv>>><vvvv<^v^v^vv>^<^<^^^>^^<>^^>>>>v>>>v^>><v^v>^^^>^v<>v>>>><^v^>vv>^v<<<^<>v>^>vv>vv^^<><>v<vv<>v<^^^>^^>>v>><<<^v><^<vv>><>v<^<vv<^^>^<^<>>v^<^vv^>>>vvv^v>v^v>^<^<<<^^>>v^vvvvv<vvv^<>><^<v^<<<<>^^><v<^>^v^v>>^>><^^^<<^^<>v<v^^v^v^vv^>>v<>v<>^vv^>^^<^><>^^<vv^>>v^<<<>^>><<v>v>v<^^^<v<<>v^>>>^v^>>v>^^v>^v>^^>v^v^<<<^vv>v<>>v<v^<<^>^^^v>v^^<<^><<^^>v^^^><v>>^<<v<^<vv<vvvv>^<><^<^><v^<vv<^^<^>>^^^vv^>><v><<<^<<^^<<<><<>>^vv>><v^^v^<v^>>^^<^><<>^^v><<>^^vv^vvv<v^vvv^<v^<<v^>v^>><<v^>>v^v>^><vv><>vvv>^>^v<vv^^>^v^<^^v^<<>^<vv>^<^><^vv<vv^>>>>><v>v>^>^><vv^<v<^>>^<^v^^v^>^v<v><v^>><>v><><<^>v<>v>><<v>^vvv^v>v^>>^<<^>^^v><>^vv<>^^><<v>>v>^<<v^<<v>>v^<<<^^^<vv^v^v>^v><<>><>>>^^><<v^>^^v^v<><<vv^>^<^<v>vv^^v^^v<v>^>v><>vvv^vv>>><>^>^^<vv>^<
><>^^>v<<>v><^<<v>^><v<v>>>^>>vvv>^><>>^v^^<^<>>v<v>>>>^>^v>>v<vv><^vvv<<<^v>><<<^>^v^vvv<^v<v^v^^>^>v><v>>^vv<>><>>>^^^>>>>>>v<>^vv><v>>^^<v>^<>^^^vvvv<v<^<^><<<>>><>v><>>^><<vvv^>v^<^^>v><vvv><>>v>v<^^<v^>>>^^>v<^<^^><><vv>^<>^<v>v>^v>v>>vv<vv^<vv<v>v<^v<^^^>^<<><^^v>v>v>>v^>>v>^v^<>^v><^v<^v^<v^<vvvv^>^>^>vv>vv<^>v<<v<<>>^v^v<v<^>>^<>v^>^^v>><v<vv>^^<<^v^<>>^<^<^<v^v><>><v><>v>v><^>^^>><vv<>><<^<^<v^^v<v^v<^><<vv>^><<vv^<^<><vv>v^^>><vv^<vvv<v>>vv^v><^^<^vvv^<<<^^<^v<><^<^<<><<v>^<v^<><^vv^^v^^^v<>^>><^vv<^<>^v><<vv^<^>^^v>^^<^>v<<<^><><<><^<^<><v<^^^^v<^<^^^^>vvvv><^vv>v^>v><vvv<><v^^<^^<^^<^<^<v<^^v>>^<<<^v^vv<>v^^>vv^^^<><>^<<^vvv>>^>v<vv>^<^vv>^>vv>>v<>v^^^<v^>vv^v^<>v^^<>v^v^>><^>v><<<>^^^><vvv>>^v<>><vv<<v<<^v>^^v<>>>vv^>>vv^^v>v><^v<vv^vvv>^^v^v^vv><<<>>^^<<<<><>vv>^^^^>^v^>^^><^vv>v>>^^<^^^v<<<^>^vv<<><v<v^^v^<vv<>><v^>><v<>>><v^<<vv^><^^<^^^>><^v^v>>>><^<><^><^<<^^v><^v>^<^<^>v<<v^^v<<^^v>vv><>>vv>^^<^><><^v^><vv<<^<<v<vv^<v^^<>vvv^<^vv>^<><<^<^^vv^>vv>>v^vv><<v^vv><<>^v^v<
>>v^><^^>vv^^>v>>v<<vv^<<^>><^v<^<>v<vv>>>v<>^>v^vv^^<>^>^>^v<^<^^^^^>vvvv>vv><vv<<>>>^v><v>v<v>^^^^><<>><^<vv^^<>^<v<v<^<<v^<v><^^^><<^>^<^>>><vv^>>^^^><<>>vv^>><^^<<^><v<^v>^^^<>^>>>v<^^^v<<^>><><^>^>v<vv^v>^^vvv^<><>><<<<^^v<>^vv>v<>^><^<^v>^><<v<><^>>^<>v<^^<v>v><v>^>>v^^vvvv^>^>>v^<vv>>^<>v><<v>^<>v^^<<>><>><^<<<^><<<v^<v><v<<>v>v^v<<>^^><<^^<v<v>v>^<>^^^v^>><<v^^vv^>>><><vv>v^>>^v^<^v<v<<v^^<v^><>v<><^v>v<>v<><<v<>^v^<v<<<<><<vv<v^v<v>^<<v<<<^<v^>^<>v>v>v<<<^^<^^vvv<<<^>v<<^>><><>v<<<<>^^^>^>^<^v>^v<v^>v^>vv^<>>v>^v^vv><<>v^>>><><<vv^<<v>>^>^>v^>^^v>>^v<^>>v<^v^vv<v^^v^<^vv^^v>v>^^>>v><^v^><vv<><v<<>v><v^v>>v<^v>>v<^^^v>^vv>v><v<>^>>vv>>^^<<^^<v<v>>^><<^vv>^v>^^^<v>^<^>v^vv>v><<v<<^<<<^v^<>^<v>>v^<^^><>vv<><>v^v>>^<<>v<<v<<<<v^v^^^>v<<^><><<><>>v<vv<vv^^^v<>v<^vv^^>>vv<^^^v^vv^>vv>v<v^<>v<v^<<<v>^<^>^v^^<<v>v^>^<vv<<><>>^<>v>^>^>v>v><v<>vv<v^v^v<>^<<>vv>^^v^^v<^^vv<<^>>^>^<v<vv^<v<^vvv^^<>><>>><vv>>v<v^v^^v><<<<><><v<v>^<vv^>>vv>^^>>v>>><vv^v><v<>^>><<><vv^>v<^^v^v^^vv<vv>>v<<><>
^^v^vv>>vv<^>^<<^v^<>v^<><><>^>v>^^<>v^v^^^v>^>vv^^>vv<^<>><v><><<>><v^><<v^^^>><v^<<>vvv<^>^^<^<><>^>^><>v>>>v>v<^>^>^vv<v<<>>>v^^<<v>>>^v<<>vv^^<<>^v<vvvv<^^>>><>^<^v<v><><^v>v^<v<^<><^^v<^v<^<<<><<^>^<v^<^><<>><v<v><>v<^^<>vv<v^<vv^v^><vvv^^^>>vv^<^>^<<<<v<<><><<v<>v<>>v>^<^>v<v<vv>^<^<>>vv><v^>>^vvv<^><^>><v^><v<v>^>v>><vv^<<v<^v<^>^><^>v<^^^<^^>^vvvvv<vv>^<>^^v>^^<^v<v>>^^<v><v>^>v<>>vv^v<><<^v<v<v<vvv<vv>vv^v<vv<>v>^<v<>v^<<v^><>^<^^^><><^<vvv^^<<v<<>^^v>^><v>>^>^v><v^<^^^<>v<<v<v<>>>^^><<<^v^v><^>vvv<>vv><^<>>v^>v^>><^>v^<>>v>>><^>^><v^>>^v>>vv<<v>^>><^^>><v^<^><<^><vv>>><vv^><>^>^vv^><^<^><>v<>>^vv>^^v>>><v><vv^>><^v^vv><^vv<>>v>>v<^^^v^v^v<v^<><^<v>>^^<<>^v<^v><vvvv^v<>vv>><vv>>v^v<<>v^v>^<vv<^<^><^^<<><>v<v^<<vv<vv<vvv<v<v^^^^^>><^vv<>vvv<<^vv^<^v^<v<<^v>>>vv^<>v><><<<^>^<<^^<>>v<^v><<^vv<^v>v^v<<v^<<v^v>^>v^>><>>^<v><><>^>><v^v>v^<^^<^v<vv^v>vvv>^^>^^<<<>v><<^v<^><<v<>>v<^>^^^<^><^<v>>vv<>v>>^^v>^^<^<><v>^<v<>^>vvv><<<<>^>^><v^>^v<^v<^<>v<^<>^>^^<^<>>^v^>v<^v^^>>^^>^v^^<>>^<
<vv^>>^vv^^<^^>v^<<<<v^><v<><v^v<vvvv^vv^^^v<<^v>>v<>>><^><^^v><<<<^^vv<v^>v<^<vv>>>>>^^>^v>^^v<vv><<v^^^^^v<^^>>^v><^<v<^<<<v<>>>vv^^<<<v>><><^<^^<><>v>^v<^^v^^v>vv><<<>^^>^v^>>^^>^v>^^>^vv^>^>vv<v>><><v><^>^v><>>>v^>>>v>^v^^<<vv^^><<<^v>v><>^v>v^>^<>v^^vv<^v><><v^><v>>>v<>^v^^>>v^v<v^>^^^^<v>^v>^>v>vv<<v^vv<<v^v^v^^v^v^>^<v><^><<^v^v^>v><^v><<><v>>vv<^vvv^>^<^v<^^>>v<><v<<v^><<^<>>^v<^>><v^v>v>^<vv^<<v<<^^>>^^<^^^vv^vvv>vv<>^^v<v><><<>>>>v^vv<v>>v^<<<^<vv^v<^<>v>^<>v<<^^>><v^>>v<v<v>>^v^<^<>^^^^<>^v<>^>^^v^vv>^<^^>>>v^^<<<>v<vv<<v<^^<>^>>><v>>v<^^^v><v<><>vv>v>^>>>v^<>v>^<<^v^><vv>v>^vvv>>>v^<v^^>^<^>>><v>v<>^^>v>v^^v><<<<vvv<<^^>v^vv^>v<<^<vv^<>>>v<<<^<<<>v^>>>v<v>^^^^^v<>v<v><vv>>>v^><>v>>v>>v<vv^>^>>v>v^^^^vv<vv^v^>v^>^>^>^^^<^v<<^^v>v<^^^^<<<<><v>><><vv^^<v<>><v^v^<>v<<v<<>vv<<<vv>v>vv>><>^<>v<>>^<<v<>v>^><v^>^>^>^^>>^v>^<<<^<<>>^><vv^v><^<^^v<<v>>^<<<v>><>v><^^<vv><v><<^<v^^><v^^<><^>>>v>vv^v>vv>^<v<^vv<<^^^<v><v^v<>^<^<v>>^>>v^>v^<><<^>^v<>><^<<<v><v<<^<v^^^v<v<^^>v^>v<^<v>>v^v
^^<>v^><v>^v<>^><>>><<^v><^><<<vv><v^<v^>>^<vvv<><><^<>v><v^v>^<vvv^v<^<^vvv<>>>^v>vv^>v<v>^^>vv^^v^<vv<<<<v^^><>>><<><vv>v^^v<>^^^v>>>^><^<v>^<<><v<^^>v^^>v>^^><>>v<>^vv<<v^><^<<vv^^v^<^vv>^>^^v<<vv<>>vv<<^v<v>^<^<>>>v<<>vv^^v^<<^^>^^^><v<<^>>>><<>^^vvvvv^><<vv><v^v>vv<>><vv^<vvv^^^<<^><<v^^><v^^<><v^<<v^^<^<v^<^v^<^>v<v>vv>^<<>^^><<v<v>^^^^v<>>>^^>v<<<^<><<<^v^<>>><vv<v^v><><>^v^vvvv>><v<vv^v<<v^v>vv^^>^>v<v>^^v<>v>^v<><<<^^v<^<^^v^vv<v^^v^<<<v<^<<<<>v>^vvv<>vvv<^>>^<v>>^><<v<><^>vv<><v<<^^<v^v<v<<^>vv^v>v^<><v<<>^v^^>><v>>>>^>>v>v>v>>^<vv>vv><>^><<^<v<<^v<><^^>^v<^v<<>>^<>vv><>^<v><>^<^<vv^v<<>><^<<>><^<vv<v>v>vvvvv^<<v<<<<>>v<<^<^^<>>>><>^^<v>v<v><<^vv<^v^<<<v>^vv^v<^<<<<<^v<vv>^>><<>vv>vv<^v<^^><<<vv<vv^>^>v><v^<>>>vv>><v<^><^>^^v^^^<>v<v<v^^>v<^<<>><vv<<^<v<<>>>^vvv^>^vv<><>^^<^^<<<>v<^><<>^><v^<<^^>v>><^>><v^<<vv^<^>>>^v^>>^<v<v<v^><v^<v>v<>>^v<v>^>v>v>v<v>v^>^v^>>vv>v<<^v>>><<^<^<><<v>>>v^>>^v<^^>^v<><v>^^<><vv^v<<^><>^^^<^^vv<^<>^^>><^<<><<^^v<v<vv^><^vvv><>>vv<^<<<<^<>^>^vv>>
<>^<v<^<<v^^<vv>^v^<^vv<^<<^<<^^<^vvv>^vvv>v^<>v^v^>><<<<<^^^^<<^<^vv<><v<<^^^<v<>>v^>v^>^vv>>^>^vv>vv^<<>><<vv^<<<>^>v<<^<>>^<^><v<^^>^<v^^>v<v^<>^><v<^^^^^v^>>>>^>v^<>v^^<vv^^v^^^v>><<><<^v^>>v^<^^<v><^<>v>^<^>><<^v<^v><v^^^^^^<<<^>^>>v>><<vv<v^^^v>>vv<<<><v<>^v^>>v<<>>><>v<>^^^<v<v^v^^^^><>>v<^vv><>>^^v>v><<>>^^^v<>>v<^>v^v<v^^^^^<^>v>vv<<v^><>vvvv^vv><^>^v^v<v<<^v>v<vv^<v<<<^><vvv><>^>^vv<^v<>vv^v><<<>><^<<<>v<^>vvv<v<^^v^><>v<^v^>v^<vv^>^<<v^^<vvv^<<><v>v><>^>^^<<^<><><v<^^^>v^^>>>>>v<<>><<v<<^<v<>v<><v<>>v>v^^^v>>>^^>v<<v>vvv>>v<>>><<>^<>>>^<^^>^>^^^vv^<^><vv<<v>v><v^^><vv<>^v<^<^<v>v<>v^v>v<^<<>^>^>^>v^>^v^^^>^^><<<v>>>>^^>^<><^v^v^>^vv><>>>^><v^<>^vvvv<<vv^^<<^><v^vvv^<^<^v>><>><v<v>v^v>><<^^<^^>vvv><>^><<^vvvvv<<><v^>^v>v^v>vvv<v<<>v^^^^>^>vvv<v<>^>^^v>^v<<v>>>>v>><>^^>v<>>>vvv^^><^>>>^^>v>^>>>v^<<v>v^vvv><^vv>^^>>><<>>v<v>v^>v<><<>vv>v^<>>v<v^>v^v<>v>>v<^><vv>v^v<><v<^v<<<><^><vv>>>^^v<v^v^>^^^<v<<v^<^<>v>^<v^v^<^<^v<<v^^<>><<<^>>^v>^<>><^><vv^<^<^^^><^v<>v^v^<^v^<^<v^<v<^^^>
v<vv^v>>^^v^v^vvvvvvv^^vv^<>^v^<vv>vvv>^><v>v<^>vv><^<>v>^>^v^^<v<^<><^^>^>vvv^^>><>v<^><v>>v^>v>v^><>>v^>^<>>><>^<vv<^v^v^vv><>>^^<^vv^<<vv^>^vv^^<v<v<vv<^^<^<<^>><<^<v^^^<<<>^^v>^<>v^^>vv<^v<^v<<>v^v^vv<v>>>v><v^v^<v<<>v^<v><v<vv<<^^^><v^^<<<<><>vvv^>^v<<<<^v^>vvv<<>>v^^vv>>v^<v<<>>v<^>><v^<<^>^>vv>>>^^v^^vv<^<^^^<^<v^v^v^v^>v><^<v<>><v>>^<<^<><>><<<^>>^v^v^v<^vvv^vv<>vvv^^^<<>^v<v^><^^>vv<><v><>^<<<>>v<>^vv>^^^v^>v>>^v>>^>vvv<<<^<^<<<v^>v>>^^v^>vvv^<<^>^v<<<><^^><v<^<>^><<v^^^^<><^<><^v>^^<>v><<v<<>^<vv>>><v>v<^^<>^<>><>><^<^>>>v>^^<>^v^<^^<^v^>^v<v<^><^>>^v^^<^^<>>>><<^v>v^^<>^^<<>^<>v>v^v<v^<^v<>>^>v^<v><<^>v>><<v>^v^><^><v^<<^^<>^>>^<>>^>>^v^v^<<v<<>v<^>v^v<<>^<vv>>v^v^<<<^v>^^>><<vv>>^v>^>^v><^>^<><>^<vv^<v^<<>^^v<>^<>^^v^><v>v^<vvv>^<^v>>>^><<<^v<v^<v>^<<<<vvv>v<^v><^vv^<>v><>^v>v><>>v<^^vv^>>^>><vv<v<v^>><>v><v<vv<><>^^v>v>>>vvv><vv^>>>>^^<^^<v>^^^v<>^^v><<v<vv<<<^>^><><vv><>v>^v^>^<^v>vvvv<^><>>>v^<>v<^^<>^>^^<<v><<^>vv^vv<^v^><vvv<vv^>v>v^>v^v>v^<v^><<^^^>><<^^<>^>v>^>^<^><>
>^>^^>v<^<^^<>>>^<<vvvvv^><v>^<><<<v>>^<^v^<v<v>>vv>><v<v^^<v<<^><v<v<>>>><><><^<>^v^<v^>v<<<>v<<vv^^^<<<v<^vv^^<><v^><>^vv>>^<><^<>>^<>vv^<<<v^<v>><<>^^>>>>>^vv^v>^^<v^>>>v>vv<<^<^<>>^v^^^>^^<>v^^>^>v<^<>^<^v^>v<v><<<^<v<^<>>^><>><<v<<v<><>^>>v<<vv<v^^<v^><>><><v<><<^v<>^^^<^>vv>>^<^><<>v^^v>v>><<v><<v>^>v>vvv>v<^v^<v^<v<v><v<v><<^^<<><v^<>>v<v^<><v>v<^<vv>v>^<<><v^<^>v>v<v<>^^>><^v>>>>>^<<<^>v^v<^>v>v><<v^<>^<>^v>>^<>^^v^^<>v<vv^<^<>>v^vvvv<^><<>v><v<vvv^<v>^^^^^<<v>>>><<<>>vv<^v>^v^>^<v>^v><>v^>>><><>><>>>^v^<<v<^v<v>vv<<v>><<<<>>v^>>v>><<>>^<<v>>>>>v^>^^<<><^>vv<<v^<vv^^v><><v>>^>>^^^>>v^>>v>^^^>v^<<>v>^v^<^<^>v^v^>vvvv^^<<>^v>v>><>^^>v>>v^v<^>^<<^vv^<^<vv<><<^>^><<<v<^<>>^>>>^v^<v><^><><v>>^<^>><^^>^^vv>^><^v<>>vvv^><v^v^<v<^v>vv<<><>^>^^^<^^<^v^^^^vv<v<><^<<^>^<^>vv^^<^^>^v^<vv>v^<^<v<v>^v>>v><v^><v^v<><vv>^<><v^^<v^<^<>>>>^^<^<^v<^^v^v<^v^<><v>^^>v<^vvv><<>vvv^v<<v<><^<<<<v<vvv>^>>v>>v><^><v<>>v>v<<<v<^<>>>^<>>>vv<<v<<>><^v^v^<vv^^v<<^>^^<^^vv>^v<<>v>v<^v^v>><<>vv<<>^><v><v<^>^^
<v>v>^>^<v^vv^v^v<v>>^>vv<>^^v>^>>vv<v>v^<^v<>>>vv><^vv<^^vv^><>>>v<<^<v^<^>>^vv<<>v^v>>>^^>v^>^<<^vv^<<^><^<v^>>vvv^^><>v^<v<v<v<^^>^v><<<^>v<<<<><^^<v<>^^<<v>v^v<vv^^><<^^v>^^^^v^vv^<v^^vv<v><<^<>v^^><v^^v<>^>>v<v^>>v>vv<<^^>^vvvv<<<v<><<>v>>><><>v<<<>vv><>v<^>v<v>v<<^><>^<^^^vvv><v^<>vv<><>vv<>^>^vv<><^v>^^<^<^vvv^<v<><>^<>^vv^<>^^v><>^>v^><>v<>^^>^^^v^>^<><>^^<>>>v^<>v<vv<<^>^>^v^<><^^><<^<^><<<^<>^<v<>vv>v<><vvv<v<><<>^^<<>vvv^v<<v<<^<v<v<<^v><vv><v^><^v>>^<^^^v^<v^>v^>^v<>><^vv>>>v><<>>vv^v<<<><<<<><>^><<<>>v^<<<^^<>>^<^<^><v<v^^<>vv>><><><<>^v<vv>v>v^<<>v<<^<v<<v>v>^v>>^v^<<<^v>v^<v<^v^v^v>><<^v^<>^v<><^><^>vv><^><>>v>^v^>>>v<>><>^vvvvv<>^<^<v>v<^v>><>v><^^v^vv>v^>^v^<<vv>^^^<^>>>v^<vv<^v>v<<v<<<^<<<^^<^<>^vv><>^v>>>v<<v<<^v><^<v<v<<<<<>vvv^<>vv<><^>v<>^vv^^><><v<<^>v^<v^v>>^><^>^<v>^vv<<v^<>^><^vv<^v>>v<v^<<<><<<^vv>>v^>v^v>vvv>v^^^^^<>vv>^<vv<<^^<v^^^v><vv<^<<><^>^^<>v>>^>vv<<><>><^vv<>^>vv<vv<^v>v>>>v>v>^<^v<>v>^^^^^v^^^v^>^^^<v^<<^^^v^vvv>^v<>v^>>^>v<v<v^><^^^>v>v>v>^>>^<<<^`

const test1 = `########
#..O.O.#
##@.O..#
#...O..#
#.#.O..#
#...O..#
#......#
########

<^^>>>vv<v>>v<<`

const test2 = `##########
#..O..O.O#
#......O.#
#.OO..O.O#
#..O@..O.#
#O#..O...#
#O..O..O.#
#.OO.O.OO#
#....O...#
##########

<vv>^<v^>v>^vv^v>v<>v^v<v<^vv<<<^><<><>>v<vvv<>^v^>^<<<><<v<<<v^vv^v>^
vvv<<^>^v^^><<>>><>^<<><^vv^^<>vvv<>><^^v>^>vv<>v<<<<v<^v>^<^^>>>^<v<v
><>vv>v^v^<>><>>>><^^>vv>v<^^^>>v^v^<^^>v^^>v^<^v>v<>>v^v^<v>v^^<^^vv<
<<v<^>>^^^^>>>v^<>vvv^><v<<<>^^^vv^<vvv>^>v<^^^^v<>^>vvvv><>>v^<<^^^^^
^><^><>>><>^^<<^^v>>><^<v>^<vv>>v>>>^v><>^v><<<<v>>v<v<v>vvv>^<><<>^><
^>><>^v<><^vvv<^^<><v<<<<<><^v<<<><<<^^<v<^^^><^>>^<v^><<<^>>^v<v^v<v^
>^>>^v>vv>^<<^v<>><<><<v<<v><>v<^vv<<<>^^v^>^^>>><<^v>>v^v><^^>>^<>vv^
<><^^>^^^<><vvvvv^v<v<<>^v<v>v<<^><<><<><<<^^<<<^<<>><<><^^^>^^<>^>v<>
^^>vv<^v^v<vv>^<><v<^v>^^^>>>^^vvv^>vvv<>>>^<^>>>>>^<<^v>^vvv<>^<><<v>
v^^>>><<^^<>>^v^<v^vv<>v^<<>^<^v^v><^<<<><<^<v><v<>vv>>v><v^<vv<>v^<<^`

const test3 = `#######
#...#.#
#.....#
#..OO@#
#..O..#
#.....#
#######

<vv<<^^<<^^`

const patterns = {
  '<': [-1, 0],
  '^': [0, -1],
  '>': [1, 0],
  v: [0, 1]
}

part1(input)
part2(input)

function part1(source) {
  const { map, moves, position } = parseSource1(source)
  moves.forEach(move => updateState1({ move, map, position }))
  const score1 = getScore(map)
  console.log({ score1 })
}

function part2(source) {
  const { map, moves, position } = parseSource2(source)
  moves.forEach(move => updateState2({ move, map, position }))
  const score2 = getScore(map)
  console.log({ score2 })
}

function parseSource1(source) {
  const [rawMap, rawMoves] = source.split('\n\n')
  const map = rawMap.split('\n').map(row => row.split(''))
  const moves = rawMoves.split('').filter(m => !!patterns[m])
  const y = map.findIndex(row => row.includes('@'))
  const x = map[y].findIndex(c => c === '@')

  return { map, moves, position: [x, y] }
}
function parseSource2(source) {
  const tiles = {
    '#': ['#', '#'],
    O: ['[', ']'],
    '.': ['.', '.'],
    '@': ['@', '.']
  }
  const [rawMap, rawMoves] = source.split('\n\n')
  const map = rawMap.split('\n').map(row =>
    row
      .split('')
      .map(c => tiles[c])
      .flat()
  )
  const moves = rawMoves.split('').filter(m => !!patterns[m])
  const y = map.findIndex(row => row.includes('@'))
  const x = map[y].findIndex(c => c === '@')

  return { map, moves, position: [x, y] }
}

function updateState1({ move, map, position }) {
  const target = [position[0] + patterns[move][0], position[1] + patterns[move][1]]
  const block = map[target[1]][target[0]]

  if (block === '#') return
  if (block === '.' || (block === 'O' && push1({ map, coords: target, move }))) {
    moveCell({ map, from: position, to: target })
    position[0] = target[0]
    position[1] = target[1]
  }
}
function updateState2({ move, map, position }) {
  const target = [position[0] + patterns[move][0], position[1] + patterns[move][1]]
  const block = map[target[1]][target[0]]

  if (block === '#') return
  if (block === '.') {
    moveCell({ map, from: position, to: target })
    position[0] = target[0]
    position[1] = target[1]
  }

  if ((block === '[' || block === ']') && push2({ map, move, coords: target, trial: true })) {
    push2({ map, move, coords: target, trial: false })
    moveCell({ map, from: position, to: target })
    position[0] = target[0]
    position[1] = target[1]
  }
}

function push1({ map, coords, move }) {
  const target = [coords[0] + patterns[move][0], coords[1] + patterns[move][1]]
  const block = map[target[1]][target[0]]

  if (block === '#') return false
  if (block === '.' || (block === 'O' && push1({ map, coords: target, move }))) {
    moveCell({ map, from: coords, to: target })
    return true
  }
}
function push2({ map, coords, move, trial }) {
  const isLeft = map[coords[1]][coords[0]] === '['
  const left = isLeft ? coords : [coords[0] - 1, coords[1]]
  const right = isLeft ? [coords[0] + 1, coords[1]] : coords

  // The left and right moves only need to check one available space
  if (move === '>') {
    const target = [right[0] + 1, right[1]]
    const block = map[target[1]][target[0]]

    if (block === '#') return false
    if (block === '.' || (block === '[' && push2({ map, coords: target, move, trial }))) {
      if (!trial) {
        moveCell({ map, from: right, to: target })
        moveCell({ map, from: left, to: right })
      }
      return true
    }
    return false
  }
  if (move === '<') {
    const target = [left[0] - 1, left[1]]
    const block = map[target[1]][target[0]]

    if (block === '#') return false
    if (block === '.' || (block === ']' && push2({ map, coords: target, move, trial }))) {
      if (!trial) {
        moveCell({ map, from: left, to: target })
        moveCell({ map, from: right, to: left })
      }
      return true
    }
    return false
  }

  // The up and down moves need to check for 2 available spaces
  const direction = move === '^' ? -1 : 1
  const targets = {
    left: [left[0], left[1] + direction],
    right: [right[0], right[1] + direction]
  }

  const blocks = {
    left: map[targets.left[1]][targets.left[0]],
    right: map[targets.right[1]][targets.right[0]]
  }

  if (blocks.left === '#' || blocks.right === '#') return false

  const canMove = { left: false, right: false }
  if (blocks.left === '.') canMove.left = true
  if (blocks.right === '.') canMove.right = true
  if (blocks.left === ']' && push2({ map, coords: targets.left, move, trial })) canMove.left = true
  if (blocks.right === '[' && push2({ map, coords: targets.right, move, trial })) canMove.right = true
  if (blocks.left === '[' && push2({ map, coords: targets.left, move, trial })) canMove.right = canMove.left = true

  if (canMove.left && canMove.right) {
    if (!trial) {
      moveCell({ map, from: left, to: targets.left })
      moveCell({ map, from: right, to: targets.right })
    }
    return true
  }
  return false
}

function moveCell({ map, from, to }) {
  if (map[to[1]][to[0]] !== '.') throw new Error('bad move')

  const tile = map[from[1]][from[0]]
  map[from[1]][from[0]] = '.'
  map[to[1]][to[0]] = tile
}

function getScore(map) {
  const goods = map.reduce((list, row, y) => {
    row.forEach((cell, x) => {
      if (cell === 'O' || cell === '[') list.push([x, y])
    })
    return list
  }, [])
  return goods.map(([x, y]) => 100 * y + x).reduce((s, v) => s + v, 0)
}
function dumpState(map) {
  map.forEach(row => console.log(row.join('')))
  console.log('')
}
